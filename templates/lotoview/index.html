{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="{% static 'style/bootstrap/bootstrap-grid.min.css' %}"
    />
    <link
      rel="stylesheet"
      href="{% static 'style/bootstrap/bootstrap.min.css' %}"
    />
    <link rel="stylesheet" href="{% static 'style/loteria.css' %}" />
    <link rel="stylesheet" href="{% static 'style/animalito.css' %}" />

    <!-- boxicon -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <!-- boxicon -->
  </head>
  <body>
    <!-- holaa -->
    <div
      id="carouselExampleFade"
      class="carousel slide carousel-fade"
      data-bs-ride="carousel"
      data-bs-interval="20000"
    >
      <div class="carousel-inner">
        <div class="carousel-item active">
          <div class="cuadroCentral">
            <!-- /* cuadro basado en el header que contiene: logo / titulo junto con hora / numero de telefono */ -->
            {% include "lotoview/header.html" %}
            <!-- /* cuadro basado en el header que contiene: logo / titulo junto con hora / numero de telefono */ -->
            <div
              class="cuadro-central"
              data-aos="zoom-in-down"
              data-aos-easing="linear"
              data-aos-duration="1500"
            >
              {% include "lotoview/animalitos/chance_animalitos.html" %}
              {% include "lotoview/animalitos/guacharo_activo.html" %}
              {% include "lotoview/animalitos/selva_plus.html" %}
              {% include "lotoview/animalitos/lotto_activo.html" %}
            </div>
          </div>
        </div>
        <div class="carousel-item">
          <div class="cuadroCentral">
            <!-- /* cuadro basado en el header que contiene: logo / titulo junto con hora / numero de telefono */ -->
            {% include "lotoview/header.html" %}
            <!-- /* cuadro basado en el header que contiene: logo / titulo junto con hora / numero de telefono */ -->
            <div
              class="cuadro-central"
              data-aos="zoom-in-down"
              data-aos-easing="linear"
              data-aos-duration="1500"
            >
            {% include "lotoview/animalitos/lotto_rey.html" %}
            {% include "lotoview/animalitos/granjita.html" %}
            {% include "lotoview/animalitos/grana_plus.html" %}
            {% include "lotoview/animalitos/ricachona.html" %}
            </div>
          </div>
        </div>
      </div>

      {% include "lotoview/buttons.html" %}
    </div>
    
    {% include "lotoview/footer.html" %}
  </body>
</html>
<script src="{% static 'js/jquery.js' %}"></script>
<script src="{% static 'js/bootstrap/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'js/bootstrap/bootstrap.min.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
  AOS.init();
</script>
<script type="text/javascript">
  function actualizarFechaHora() {
    let ahora = new Date();

    // Formatea la fecha como DD/MM/YY
    let fecha = ahora.toLocaleDateString('es-VE', { day: '2-digit', month: '2-digit', year: 'numeric' });

    // Formatea la hora como HH:MM:SS
    let hora = ahora.toLocaleTimeString('es-VE', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

    // Actualiza los elementos HTML
    document.getElementById('fecha').textContent = 'RESULTADO DE LOS ANIMALITOS ' + fecha;
    document.getElementById('hora').textContent = hora;
}

// Actualiza la fecha y la hora cada segundo
setInterval(actualizarFechaHora, 1000);

</script>
<script type="text/javascript">
let webSocket;
let url = `wss://${window.location.host}/ws/socket-server/`

function connect() {
    webSocket = new WebSocket(url);

    webSocket.onopen = function(e) {
        // console.log('Conexión WebSocket abierta');
    };

    webSocket.onclose = function(e) {
        // console.log('Conexión WebSocket cerrada. Reconectando...');
        setTimeout(connect, 1000);
    };

    webSocket.onerror = function(err) {
        // console.error('WebSocket Error:', err);
    };

    webSocket.onmessage = function(e) {
      let data = JSON.parse(e.data);
      // console.log('Data:', data);

      // Obtiene el ID de la tabla de los datos
      let tablaId = data.modelo;

      // Busca todas las filas de la tabla
      let filas = document.querySelectorAll(`#${tablaId} tbody tr`);

      // Itera sobre las filas para encontrar la que tiene la misma hora
      for (let i = 0; i < filas.length; i++) {
          let fila = filas[i];
          let hora = fila.children[0].textContent;

          // Si la hora de la fila coincide con la hora de los datos recibidos
          if (hora === data.hour_sort) {
              // Actualiza los datos de la fila
              fila.children[1].textContent = data.animalito;
              fila.children[2].textContent = data.animalito_name;
              let imagen = fila.children[3].children[0];
              imagen.src = data.image_path;
              imagen.alt = data.animalito_name;

              // Elimina el estilo de la imagen
              imagen.style.opacity = '1';

              break;
          }
      }
    };
}
connect();
</script>
